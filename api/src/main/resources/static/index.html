<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Login</title>
</head>
<body>
<h1>LOGIN BANCO</h1>

<!-- Botão para abrir a janela modal -->
<button id="btnOpenModal">Login</button>

<!-- Janela modal -->
<div id="modal" style="display: none">
	<form id="loginForm">
		<input type="text" name="username" placeholder="Username">
		<input type="password" name="password" placeholder="Password">
		<button type="submit">Entrar</button>
	</form>
	
	<button id="btnCloseModal">Fechar</button>
</div>

<script>
      // Seleciona os elementos HTML relevantes
      const modal = document.getElementById("modal");
      const loginForm = document.getElementById("loginForm");

      // Adiciona um evento de clique ao botão de login
      document.getElementById("btnOpenModal").addEventListener("click", function() {
        modal.style.display = "block";
      });

      // Adiciona um evento de clique ao botão de fechar da janela modal
      document.getElementById("btnCloseModal").addEventListener("click", function() {
        modal.style.display = "none";
      });

      // Adiciona um evento de envio ao formulário de login
      loginForm.addEventListener("submit", function(event) {
        event.preventDefault();

        // Obtém as informações de login do formulário
        const formData = new FormData(loginForm);
        const username = formData.get("username");
        const password = formData.get("password");

        // Envia as informações de login para o backend
        fetch("/login", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ username, password })
        })
        .then(response => {
          // Verifica se a autenticação foi bem-sucedida
          if (response.ok) {
            // Armazena o token de autenticação no local storage
            const token = response.headers.get("Authorization");
            localStorage.setItem("token", token);

            // Fecha a janela modal
            modal.style.display = "none";

            // Redireciona para a página de produtos
            window.location.href = "/produtos";
          } else {
            // Exibe uma mensagem de erro caso a autenticação tenha falhado
            alert("Login falhou. Tente novamente.");
          }
        })
        .catch(error => {
          console.error(error);
        });
      });
    </script>
</body>
</html>
